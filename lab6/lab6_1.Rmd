---
title: "`mutate()`, and `if_else()`"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Use `mutate()` to add columns in a dataframe.  
2. Use `mutate()` and `if_else()` to replace values in a dataframe.  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("janitor")
```

## Load the data
For this lab, we will use the following two datasets:  

1. 1. Gaeta J., G. Sass, S. Carpenter. 2012. Biocomplexity at North Temperate Lakes LTER: Coordinated Field Studies: Large Mouth Bass Growth 2006. Environmental Data Initiative.   [link](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-ntl&identifier=267)  

2. S. K. Morgan Ernest. 2003. Life history characteristics of placental non-volant mammals. Ecology 84:3402.   [link](http://esapubs.org/archive/ecol/E084/093/)  

## Pipes `%>%` 
Recall that we use pipes to connect the output of code to a subsequent function. This makes our code cleaner and more efficient. One way we can use pipes is to attach the `clean_names()` function from janitor to the `read_csv()` output.  
```{r}
fish <- readr::read_csv("data/Gaeta_etal_CLC_data.csv")
```

```{r}
mammals <- read_csv("data/mammal_lifehistories_v2.csv") %>% clean_names()
#Attach clean_names() via a pipe. 
```

## `mutate()`  
Mutate allows us to create a new column from existing columns in a data frame. We are doing a small introduction here and will add some additional functions later. Let's convert the length variable from cm to millimeters and create a new variable called length_mm.  
```{r}
fish %>% 
  mutate(length_mm = length*10) %>%  #new variable length in mm take the length and multiply by 10; it was originally cm
  select(fish_id, length, length_mm) #the variable in the table still says length
```

## Practice
1. Use `mutate()` to make a new column that is the half length of each fish: length_half = length/2. Select only fish_id, length, and length_half.
```{r}
fish %>% 
  mutate(length_half = length/2) %>% #new variable name equals the formula; look and compare length and compare to length half
  select(fish_id, length, length_half)
```

## `mutate_all()`
This last function is super helpful when cleaning data. With "wild" data, there are often mixed entries (upper and lowercase), blank spaces, odd characters, etc. These all need to be dealt with before analysis.  

Here is an example that changes all entries to lowercase (if present).  
```{r}
mammals #some cells have uppercase and some have lowercase (these are scientifically correct)
```

```{r}
mammals %>%
  mutate_all(tolower) #Taking all the observations and making them lower case
```

Using the across function we can specify individual columns.
```{r}
mammals %>% 
  mutate(across(c("order", "family"), tolower)) #mutate across the columns order and family 
#This output is not stored anywhere! 
```

#Note: for mutate we won't have to create a new object! 
#Note: cleannames only does the column names 

## `if_else()`
We will briefly introduce `if_else()` here because it allows us to use `mutate()` but not have the entire column affected in the same way. In a sense, this can function like find and replace in a spreadsheet program. With `ifelse()`, you first specify a logical statement, afterwards what needs to happen if the statement returns `TRUE`, and lastly what needs to happen if it's  `FALSE`.  
#find objects of interest and replace with what you want 

Have a look at the data from mammals below. Notice that the values for newborn include `-999.00`. This is sometimes used as a placeholder for NA (but, is a really bad idea). We can use `if_else()` to replace `-999.00` with `NA`.  
```{r}
mammals %>% 
  select(genus, species, newborn) %>% 
  arrange(newborn)
```

```{r}
mammals %>% #Replace values with NA 
  select(genus, species, newborn) %>%
  mutate(newborn_new = ifelse(newborn == -999.00, NA, newborn))%>% 
#create new variable newborn_new and if it sees -999.00 it will but a NA if not then it will leave the value alone and not make any changes. 
#you always want to create a new variable so you know how things have changed. 
  arrange(newborn)
```

## Practice
1. We are interested in the family, genus, species and max life variables. Because the max life span for several mammals is unknown, the authors have use -999 in place of NA. Replace all of these values with NA in a new column titled `max_life_new`. Finally, sort the date in descending order by max_life_new. Which mammal has the oldest known life span?
```{r}
mammals %>% 
  select(family, genus, species, max_life) %>% 
  mutate(max_life_new = ifelse(max_life == -999, NA, max_life)) %>% 
  arrange(max_life)

```

## That's it! Let's take a break and then move on to part 2! 

-->[Home](https://jmledford3115.github.io/datascibiol/)  